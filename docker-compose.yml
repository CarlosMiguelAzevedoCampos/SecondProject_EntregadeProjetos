version: '3.4'

services:
  cma.ismai.delivery.api.ui:
    image: ${DOCKER_REGISTRY-}cmaismaideliveryapiui
    networks:
      - deliveryproject_network
    container_name: cmaismaideliveryapiui
    ports:
    - 5668:80
    - 5669:443
    restart: always
    build:
      context: .
      dockerfile: CMA.ISMAI.Delivery.API.UI/Dockerfile
    volumes:
      - C:\Users\Carlos Campos\Desktop\Production\Unzip:/Production/Unzip 
      - C:\Users\Carlos Campos\Desktop\Production\Zip:/Production/Zip 
    environment:
      - RabbitMqCore__Uri=rabbitmq 
      - RabbitMqCore__Username=admin
      - RabbitMqCore__Password=admin 
      - RabbitMqCore__Port=5672 
      - ElasticConfiguration__Uri=http://elasticsearch:9200/
      - EventStore__IPAddress=tcp://admin:changeit@eventstore:1113 
      - FilePathZip__Path=/Production/Zip/
      - FilePathUnzip__Path=/Production/Unzip/

  cma.ismai.delivery.fileloading.ui:
    image: ${DOCKER_REGISTRY-}cmaismaideliveryfileloadingui
    networks:
      - deliveryproject_network
    container_name: cmaismaideliveryfileloadingui
    restart: always
    build:
      context: .
      dockerfile: CMA.ISMAI.Delivery.FileLoading.UI/Dockerfile
    volumes:
      - C:\Users\Carlos Campos\Desktop\Production\Unzip:/Production/Unzip 
      - C:\Users\Carlos Campos\Desktop\Production\Zip:/Production/Zip 
    environment:
      - RabbitMqCore__Uri=rabbitmq 
      - RabbitMqCore__Username=admin
      - RabbitMqCore__Password=admin
      - RabbitMqCore__Port=5672
      - ElasticConfiguration__Uri=http://elasticsearch:9200/
      - EventStore__IPAddress=tcp://admin:changeit@eventstore:1113
      - Camunda__Uri=http://camunda:8080/engine-rest/engine/default/
      - FilePathZip__Path=/Production/Zip/
      - FilePathUnzip__Path=/Production/Unzip/  
      - Notification__Email=carlosmiguelcampos1996@gmail.com 
      - NotificationEmail__Email=trelloismai@gmail.com 
      - NotificationEmail__Password=trelloteste123
      - NotificationEmail__Host=smtp.gmail.com
      - NotificationEmail__Port=587
      - TimeToFetch__Time=60000
      - TaskPerFetch__Time=30 

  cma.ismai.delivery.fileprocessing.ui:
    image: ${DOCKER_REGISTRY-}cmaismaideliveryfileprocessingui
    networks:
      - deliveryproject_network
    restart: always
    container_name: cmaismaideliveryfileprocessingui
    build:
      context: .
      dockerfile: CMA.ISMAI.Delivery.FileProcessing.UI/Dockerfile
    volumes:
      - C:\Users\Carlos Campos\OneDrive\Document:/Document/OneDrive
      - C:\Users\Carlos Campos\Desktop\ismai.xlsx:/Jury/ismai.xlsx
      - C:\Users\Carlos Campos\Desktop\Production\Unzip:/Production/Unzip 
      - C:\Users\Carlos Campos\Desktop\Production\Zip:/Production/Zip 
      - C:\Users\Carlos Campos\Desktop\Image\ismai.png:/Image/ISMAI/ismai.png
    environment:
      - RabbitMqCore__Uri=rabbitmq 
      - RabbitMqCore__Username=admin 
      - RabbitMqCore__Password=admin
      - RabbitMqCore__Port=5672 
      - ElasticConfiguration__Uri=http://elasticsearch:9200/ 
      - EventStore__IPAddress=tcp://admin:changeit@eventstore:1113 
      - Camunda__Uri=http://camunda:8080/engine-rest/engine/default/
      - FilePathJury__Path=//Jury//ismai.xlsx 
      - OneDrive__Path=/Document/OneDrive 
      - TimeToFetch__Time=60000
      - TaskPerFetch__Time=30 
      - Notification__Email=carlosmiguelcampos1996@gmail.com
      - NotificationEmail__Email=trelloismai@gmail.com 
      - NotificationEmail__Password=trelloteste123
      - NotificationEmail__Host=smtp.gmail.com
      - NotificationEmail__Port=587
      - FilePathZip__Path=/Production/Zip  
      - FilePathUnzip__Path=/Production/Unzip 
      - Logo__Path=/Image/ISMAI/ismai.png

  cma.ismai.delivery.payment.ui:
    image: ${DOCKER_REGISTRY-}cmaismaideliverypaymentui
    networks:
      - deliveryproject_network
    container_name: cmaismaideliverypaymentui
    restart: always
    build:
      context: .
      dockerfile: CMA.ISMAI.Delivery.Payment.UI/Dockerfile
    volumes:
      - C:/Users/Carlos Campos/Desktop/excel.xlsx:/Payment/excel.xlsx 
      - C:\Users\Carlos Campos\Desktop\Production\Unzip:/Production/Unzip 
      - C:\Users\Carlos Campos\Desktop\Production\Zip:/Production/Zip 
    environment:
      - COMPOSE_CONVERT_WINDOWS_PATHS=1 
      - RabbitMqCore__Uri=rabbitmq 
      - RabbitMqCore__Username=admin 
      - RabbitMqCore__Password=admin 
      - RabbitMqCore__Port=5672
      - ElasticConfiguration__Uri=http://elasticsearch:9200/
      - EventStore__IPAddress=tcp://admin:changeit@eventstore:1113 
      - Camunda__Uri=http://camunda:8080/engine-rest/engine/default/ 
      - FilePathPayment__Path=//Payment//excel.xlsx 
      - TimeToFetch__Time=60000
      - TaskPerFetch__Time=30 
      - Notification__ManualProcessing=carlosmiguelcampos1996@gmail.com 
      - Notification__University=carlosmiguelcampos1996@gmail.com  
      - NotificationEmail__Email=trelloismai@gmail.com 
      - NotificationEmail__Password=trelloteste123
      - NotificationEmail__Host=smtp.gmail.com
      - NotificationEmail__Port=587
      - FilePathZip__Path=/Production/Zip  
      - FilePathUnzip__Path=/Production/Unzip 


 elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:6.2.4
    container_name: elasticsearch
    ports:
     - "9200:9200"
    volumes:
     - ./elasticsearch-data:/usr/share/elasticsearch/data
    networks:
     - deliveryproject_network
    restart: always
 
   kibana:
    image: docker.elastic.co/kibana/kibana:6.2.4
    container_name: kibana
    ports:
     - "5601:5601"
    depends_on:
     - elasticsearch
    volumes:
      - ./kibana-data:/usr/share/kibana/kibana.yml
    networks:
     - deliveryproject_network
    restart: always
 
   rabbitmq:
    image: rabbitmq:management
    container_name: rabbitmq
    hostname: rabbitmq
    environment:
     RABBITMQ_ERLANG_COOKIE: "SWQOKODSQALRPCLNMEQG"
     RABBITMQ_DEFAULT_USER: "admin"
     RABBITMQ_DEFAULT_PASS: "admin"
     RABBITMQ_DEFAULT_VHOST: "/"
    ports:
     - "5672:5672"
     - "15672:15672"
    networks:
    - deliveryproject_network
    privileged: true
    volumes:
    - ./rabbitmq-data/:/var/lib/rabbitmq/mnesia
    restart: always
 
   camunda:
    container_name: camunda
    image: camunda/camunda-bpm-platform:latest
    ports:
     - "8080:8080"
    networks:
     - deliveryproject_network
    volumes:
    - ./camunda-data/:/camunda/camunda-h2-dbs
    restart: always
 
   eventstore.db:
     container_name: eventstore
     image: eventstore/eventstore:release-5.0.8
     environment:
       - EVENTSTORE_CLUSTER_SIZE=1
       - EVENTSTORE_INT_TCP_PORT=1112
       - EVENTSTORE_EXT_TCP_PORT=1113
       - EVENTSTORE_INT_HTTP_PORT=2112
       - EVENTSTORE_EXT_HTTP_PORT=2113
     ports:
       - "1112:1112"
       - "1113:1113"
       - "2112:2112"
       - "2113:2113"
     volumes:
       - ./eventstore-data:/var/lib/eventstore
       - ./eventstore-log:/var/log/eventstore
     networks:
       - deliveryproject_network
     restart: always
   portainer:
      image: portainer/portainer
      ports:
        - "9000:9000"
      volumes:
        - ./portainer_data:/data
        - /var/run/docker.sock:/var/run/docker.sock
      networks:
        - deliveryproject_network

networks:
  deliveryproject_network:
    driver: bridge
